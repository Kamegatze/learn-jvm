<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <th:block th:replace="~{fragments/links :: links}"></th:block>
    <meta charset="UTF-8">
    <th:block th:replace="~{fragments/links :: title}"></th:block>
</head>
<body>
    <div class="page">
        <th:block th:replace="~{fragments/header :: header}"></th:block>
        <div class="page-content d-flex aligns-items-center flex-direction-column">
            <th:block th:replace="~{fragments/articles/bar-search-article :: bar-search-article}"></th:block>
            <!--/*@thymesVar id="articles" type="java.util.List<com.kamegatze.learnjvm.model.articles.Article>"*/-->
            <th:block th:if="${!articles.isEmpty()}" th:each="article, item : ${articles}">
                <th:block th:replace="~{fragments/articles/collection-article :: collection-article-editor}"></th:block>
            </th:block>
            <th:block th:if="${articles.isEmpty()}">
                <th:block th:replace="~{fragments/articles/not-found-article :: not-found-article}"></th:block>
            </th:block>
        </div>
        <th:block th:replace="~{fragments/footer :: footer}"></th:block>
    </div>
    <script>
        function changeStateCheckbox(form) {
            const checkbox = form.querySelector(".switch-input")
            const body = createBody(checkbox, form)
            fetch(form.action, {
                method: "POST",
                body,
                headers: {
                    "Content-type": "application/x-www-form-urlencoded"
                }
            }).then().catch(() => {
                alert("Communication error with the server, check the Internet connection")
                checkbox.checked = !checkbox.checked
            })
        }

        function createBody(checkbox, form) {
            let csrf
            form.querySelectorAll("input").forEach(item => {
               if (item.name === '_csrf') {
                   csrf = item
               }
            });
            return `${csrf.name}=${csrf.value}&published=${checkbox.checked}`
        }
    </script>
</body>
</html>